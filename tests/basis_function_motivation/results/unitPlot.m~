close all; clear;
dirFolder='';

folderStruc=dir('unitTest*');
folderName={};

FN = max(size(folderStruc));

for i = 1:FN
    folderName{i} = folderStruc(i).name;
end

value.exact=[];
value.sg=[];
value.hdmr=[];

points.sg=[];
points.hdmr=[];

err.sg=[];
err.hdmr=[];

%Funciton values -F
value.exact = csvread(strcat(dirFolder,folderName{i},'/exact.csv'));
value.sg    = csvread(strcat(dirFolder,folderName{i},'/sgInterpolate.csv'));
value.hdmr  = csvread(strcat(dirFolder,folderName{i},'/hdmrInterpolate.csv'));

%Input Value   X
X = csvread(strcat(dirFolder,folderName{i},'/x.csv'));

%Number of points in SG & HDMR
points.sg   = csvread(strcat(dirFolder,folderName{i},'/gridpoints_sg.csv'));
points.hdmr = csvread(strcat(dirFolder,folderName{i},'/gridpoints_hdmr.csv'));

%Error
err.sg   = value.sg - value.exact;
err.hdmr = value.hdmr - value.exact;

%Number of functions
N=size(value.exact,2);

%Dimention
D=size(X,2);

%Number of data points
ND=max(size(X));



for i=1:N
 RowName{i}=sprintf('F(%d)',i);
end

L1sg = sum(abs(err.sg),1)/ND;
L2sg = sqrt(sum(err.sg.^2,1))/ND;
LIsg = max(abs(err.sg));

L1hdmr = sum(abs(err.hdmr),1)/ND;
L2hdmr = sqrt(sum(err.hdmr.^2,1))/ND;
LIhdmr = max(abs(err.hdmr));

format shortG
format compact
L1_error=[L1sg',L1hdmr',L1hdmr'./L1sg'-1];
L2_error=[L2sg',L2hdmr',L2hdmr'./L2sg'-1];
LI_error=[LIsg',LIhdmr',LIhdmr'./LIsg'-1];

disp('Error Tables [SG,HDMR,HDMR/SG-1]');

T = table(L1_error,L2_error,LI_error,...
    'RowNames',RowName)

disp('Generating Plots ...');
%Genearte combination of dimentions in 2d
dimCuts = nchoosek((1:D),2);
Dset = size(dimCuts,1);

h=max(size(X));
[xq,yq] = meshgrid(0:1/h:1, 0:1/h:1);

for i=1:N
    figure
    plotCell=0;
    
    for j=1:Dset
        
        D1=dimCuts(j,1);
        D2=dimCuts(j,2);
        
        x=X(:,D1);
        y=X(:,D2);

        v0= value.exact(:,i);
        v1= abs(err.sg(:,i));
        v2= abs(err.hdmr(:,i));
        v3= v2./v1-1;
        
        % Exact Solution           
        plotCell=plotCell+1;        
        subplot(Dset,4, plotCell);
        vq0 = griddata(x,y,v0,xq,yq);
        mesh(xq,yq,vq0);
        hold on
       % plot3(x,y,v0,'*');
        hold on    
        title(sprintf('Exact Solution-(D%d,D%d)',D1,D2));
        xlabel(sprintf('D%d',D1));
        ylabel(sprintf('D%d',D1));
        zlabel('Value');
        
        % SG ABS Error
        plotCell=plotCell+1;        
        subplot(Dset,4, plotCell);
        vq1 = griddata(x,y,v1,xq,yq);
        mesh(xq,yq,vq1);
        hold on
      %  plot3(x,y,v1,'*');
        hold on
        title(sprintf('SG ABS Error-(D%d,D%d)',D1,D2));
        xlabel(sprintf('D%d',D1));
        ylabel(sprintf('D%d',D1));
        zlabel('Value');
        
        % HDMR ABS Error                
        plotCell=plotCell+1;        
        subplot(Dset,4, plotCell);
        vq2 = griddata(x,y,v2,xq,yq);
        mesh(xq,yq,vq2);
        hold on
       % plot3(x,y,v2,'*');
        hold on
        title(sprintf('HDMR ABS Error-(D%d,D%d)',D1,D2));
        xlabel(sprintf('D%d',D1));
        ylabel(sprintf('D%d',D1));
        zlabel('Value');
        
        % HDMR error vs SG Error          
        plotCell=plotCell+1;        
        subplot(Dset,4, plotCell);
        vq3 = griddata(x,y,v3,xq,yq);
        mesh(xq,yq,vq3);
        hold on
        %plot3(x,y,v3,'*');
        hold on        
        title(sprintf('HDMR error vs SG Error-(D%d,D%d)',D1,D2));
        xlabel(sprintf('D%d',D1));
        ylabel(sprintf('D%d',D1));
        zlabel('Value');
        
    end
     suplabel(sprintf('Function (%d)',i),'t');
end



